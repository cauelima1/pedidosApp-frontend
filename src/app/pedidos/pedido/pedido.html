<div class="p-4 max-w-screen-2xl mx-auto bg-gray-50 shadow-lg rounded-lg mt-6 mb-10">
    <h1 class="text-2xl font-semibold text-center mb-2">Pedidos por cliente</h1>

    <div class="flex justify-center">

        @if(!selecionar){
        <div class="w-1/2 text-center mt-5 mr-5">
            <label class="text-lg font-semibold mb-2">Cliente</label>
            <select [(ngModel)]="selecionarCliente" name="selecionarCliente"
                class="border p-2 rounded w-full mb-2 text-lg">

                @for(cliente of clientes; track cliente.nome){
                <option [ngValue]="cliente" class="text-lg font-sans">{{cliente.nome}}</option>
                }
            </select>
            <button (click)="carregarClienteSelecionado()"
                class="text-lg w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-800"
                (click)="mostrarTelaCliente()">
                Selecionar Cliente</button>
        </div>
        }


        @if(selecionar){
        <div class="flex flex-col w-10/12 text-center mt-5 mr-5">
            <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
                <h2 class="text-xl font-semibold text-gray-800 border-b pb-2">Informa√ß√µes do Cliente</h2>
                <table class="table-auto w-full bg-white rounded-lg shadow-md">
                    <thead>
                        <tr class="bg-gray-100 text-left">
                            <th class="px-4 py-2 text-gray-700 font-semibold text-start">#</th>
                            <th class="px-4 py-2 text-gray-700 font-semibold text-start">#</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-t">
                            <td class="px-4 py-2 font-medium text-gray-800 text-start">Cliente</td>
                            <td class="px-4 py-2 text-gray-600 text-start">{{ clienteSelecionado?.nome }}</td>
                        </tr>
                        <tr class="border-t">
                            <td class="px-4 py-2 font-medium text-gray-800 text-start">CNPJ</td>
                            <td class="px-4 py-2 text-gray-600 text-start">{{ clienteSelecionado?.cnpj }}</td>
                        </tr>
                        <tr class="border-t">
                            <td class="px-4 py-2 font-medium text-gray-800 text-start">Endere√ßo</td>
                            <td class="px-4 py-2 text-gray-600 text-start">
                                {{ clienteSelecionado?.endereco }}, {{ clienteSelecionado?.municipio }} / {{
                                clienteSelecionado?.uf }}
                            </td>
                        </tr>
                        <tr class="border-t">
                            <td class="px-4 py-2 font-medium text-gray-800 text-start">Observa√ß√µes</td>
                            <td class="px-4 py-2 text-gray-600 text-start">{{ clienteSelecionado?.obs }}</td>
                        </tr>
                    </tbody>
                </table>

                <div class="flex gap-6">
                    <button (click)="mostrarTelaPedidos()"
                        class="mt-2 text-lg w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-900">
                        Ver Pedidos</button>


                    <button (click)="mostrarTelaNovoPedido()"
                        class="mt-2 text-lg w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-900">
                        Criar Pedido</button>
                    <hr>
                </div>
            </div>
        </div>

        }

    </div>
</div>

@if(verPedidos){
    <div class="px-10">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">üì¶ Mostrando pedidos para cliente</h3>

<div class="overflow-x-auto">
    <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow">
        <thead class="bg-gray-100 text-gray-700">
            <tr>
                <th class="px-4 py-2 text-left">ID</th>
                <th class="px-4 py-2 text-left">Data de Emiss√£o</th>
                <th class="px-4 py-2 text-left">Quantidade de Items: </th>
                <th class="px-4 py-2 text-left">Observa√ß√µes</th>
                 <th class="px-4 py-2 text-left">A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            @for(pedido of pedidos; track pedido.id){
            <tr class="border-t hover:bg-gray-50">
                <td class="px-4 py-2">{{ pedido.id }}</td>
                <td class="px-4 py-2">{{ pedido.data | date:'dd/MM/yyyy' }}</td>
                <td class="px-4 py-2">{{ pedido.items?.length }} Items</td>
                <td class="px-4 py-2">{{ pedido.observacoes}}</td>
                
                
                <a (click)="verPedido(pedido)" class="px-1 py-1 hover:cursor-pointer">
                     <mat-icon fontIcon="search"></mat-icon>
                </a>

                    <a (click)="editarPedido(pedido)" class="px-1 py-1 hover:cursor-pointer">
                     <mat-icon fontIcon="edit"></mat-icon>
                </a>

                    <a (click)="deletarPedido(pedido)" class="px-1 py-1 hover:cursor-pointer">
                     <mat-icon fontIcon="delete"></mat-icon>
                </a>

            </tr>
            }
        </tbody>
    </table>
</div>
    </div>

}



@if(criarPedido){
<div class="px-10 max-w-screen-2xl mx-auto bg-gray-50 shadow-lg rounded-lg mt-4 mb-5">
    <h1 class="text-lg font-semibold text-center mb-2">Adicionar Pedido</h1>
    <p class="text-lg text-center py-4">Informe todos os campos em %, somente n√∫meros: </p>

    <form [formGroup]="pedidoForm" (ngSubmit)="salvarPedido()">
        <div class="grid grid-cols-3 gap-x-10 gap-y-6 justify-center text-center">

            <!-- IPI -->
            <div>
                <label class="border text-lg">IPI: </label>
                <input id="ipi" formControlName="ipi" name="ipi"
                    class="shadow-md border rounded mb-2 px-3 py-2 text-lg w-20" type="number" />
                <label class="font-semibold text-lg"> %</label>
                @if(isCampoInvalido('ipi')){
                <span class="text-red-500 text-sm">Campo obrigat√≥rio</span>
                }
            </div>

            <!-- ST -->
            <div>
                <label class="border text-lg">ST: </label>
                <input id="st" formControlName="st" name="st"
                    class="shadow-md border rounded mb-2 px-3 py-2 text-lg w-20" type="number" />
                <label class="font-semibold text-lg"> %</label>
                @if(isCampoInvalido('st')){
                <span class="text-red-500 text-sm">Campo obrigat√≥rio</span>
                }
            </div>

            <!-- ICMS -->
            <div>
                <label class="border text-lg">ICMS: </label>
                <input id="icms" formControlName="icms" name="icms"
                    class="shadow-md border rounded mb-2 px-3 py-2 text-lg w-20" type="number" />
                <label class="font-semibold text-lg"> %</label>
                @if(isCampoInvalido('icms')){
                <span class="text-red-500 text-sm">Campo obrigat√≥rio</span>
                }
            </div>

            <!-- MC -->
            <div>
                <label class="border text-lg">MC: </label>
                <input id="mc" formControlName="mc" name="mc"
                    class="shadow-md border rounded mb-2 px-3 py-2 text-lg w-20" type="number" />
                <label class="font-semibold text-lg"> %</label>
                @if(isCampoInvalido('mc')){
                <span class="text-red-500 text-sm">Campo obrigat√≥rio</span>
                }
            </div>

            <!-- MC1 -->
            <div>
                <label class="border text-lg">MC1: </label>
                <input id="mc1" formControlName="mc1" name="mc1"
                    class="shadow-md border rounded mb-2 px-3 py-2 text-lg w-20" type="number" />
                <label class="font-semibold text-lg"> %</label>
                @if(isCampoInvalido('mc1')){
                <span class="text-red-500 text-sm">Campo obrigat√≥rio</span>
                }
            </div>

            <!-- Frete -->
            <div>
                <label class="border text-lg">Frete: </label>
                <input id="frete" formControlName="frete" name="frete"
                    class="shadow-md border rounded mb-2 px-3 py-2 text-lg w-20" type="number" />
                <label class="font-semibold text-lg"> %</label>
                @if(isCampoInvalido('frete')){
                <span class="text-red-500 text-sm">Campo obrigat√≥rio</span>
                }
            </div>

            <!-- stvd -->
            <div>
                <label class="border text-lg">STVD: </label>
                <input id="stvd" formControlName="stvd" name="stvd"
                    class="shadow-md border rounded mb-2 px-3 py-2 text-lg w-20" type="number" />
                <label class="font-semibold text-lg"> %</label>
                @if(isCampoInvalido('stvd')){
                <span class="text-red-500 text-sm">Campo obrigat√≥rio</span>
                }
            </div>

        </div>

        <div class="flex-row justify-center text-center mb-10">
            <!-- Observacoes -->
            <div class="px-2">
                <label class="border text-lg">Observa√ß√µes: </label>
                <textarea id="observacoes" formControlName="observacoes" name="observacoes"
                    class="shadow-md border border-gray-300 rounded mb-2 px-3 py-2 text-lg w-full" type="text">
            </textarea>
            </div>

            <!-- Condicoes Frete -->
            <div class="px-2">
                <label class="border text-lg">Condi√ß√µes de Frete: </label>
                <textarea id="condicaoFrete" formControlName="condicaoFrete" name="condicaoFrete"
                    class="shadow-md border rounded mb-2 px-3 py-2 text-lg w-full" type="text">
            </textarea>
            </div>
            <button type="submit" [disabled]="isDisabled"
                class="mb-5 text-lg w-full bg-lime-600 text-white px-4 py-2 rounded hover:bg-lime-900">Salvar e
                Adicionar Produtos</button>

            @if(idPedido != null){
            <span class="text-2xl text-green-500 font-semibold py-5">Pedido criado n¬∫: {{idPedido}}</span>
            }
        </div>
    </form>


</div>
}


@if (listarItems) {
<div class="overflow-x-auto rounded-lg shadow-md border border-gray-200 bg-gray-200 p-4">
    <h1 class="text-2xl font-semibold text-center mb-2">Produtos:</h1>
    <table class="min-w-full divide-y divide-gray-200 text-sm text-left">
        <thead class="bg-gray-100 text-gray-700 uppercase tracking-wider">
            <tr>
                <th class="px-4 py-2">#</th>
                <th class="px-4 py-2">Nome</th>
                <th class="px-4 py-2">Quantidade</th>
                <th class="px-4 py-2">Custo</th>
                <th class="px-4 py-2">IPI</th>
                <th class="px-4 py-2">ST</th>
                <th class="px-4 py-2">C. Unit</th>
                <th class="px-4 py-2">C. Total</th>
                <th class="px-4 py-2">MC</th>
                <th class="px-4 py-2">MC1</th>
                <th class="px-4 py-2">Frete</th>
                <th class="px-4 py-2">V.TOT</th>
                <th class="px-4 py-2">ST VD</th>
                <th class="px-4 py-2">PR√á F</th>
                <th class="px-4 py-2">V.TOT F</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
            @for (item of items; track item.id) {
            <tr class="hover:bg-gray-50 transition-colors">
                <td class="px-4 py-2 font-medium text-gray-800">{{ item.id }}</td>
                <td class="px-4 py-2 font-medium text-gray-800">{{ item.nome }}</td>
                <td class="px-4 py-2 text-gray-600">{{ item.quantidade }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.custo | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.ipi | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.st | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.custoUnitario | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.custoTotal | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.mc | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.mc1 | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.frete | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.vtot | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.stvd | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.prcf | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-green-600">{{ item.vtot | currency:'BRL' }}</td>
                <td class="px-4 py-2 text-center">
                    @if(item.id != null){
                    <button
                        class="text-red-600 hover:text-red-800 font-bold px-2 py-1 rounded transition-colors duration-200"
                        (click)="deletarItem(item.id)" title="Remover item">
                        ‚úï
                    </button>
                    }

                </td>

            </tr>
            }
        </tbody>
    </table>
</div>

}


@if(criarItem){
<div class="px-10 max-w-screen-xl mx-auto bg-white shadow rounded-lg mt-6 mb-10">
    <h1 class="text-xl font-semibold text-center mb-4">Adicionar item</h1>

    <form [formGroup]="itemForm" (ngSubmit)="salvarItem()" class="space-y-4">

        <!-- Nome do produto -->
        <div>
            <label for="nome" class="block text-sm font-medium text-gray-700 mb-1">Nome do produto:</label>
            <textarea id="nome" name="nome" formControlName="nome"
                class="border border-gray-300 rounded px-3 py-2 w-full resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
            @if(isCampoInvalidoItemForm('nome')){
            <span class="text-red-500 text-sm">Campo obrigat√≥rio</span>
            }
        </div>

        <!-- Linha de campos agrupados -->
        <div class="grid grid-cols-2 gap-4">

            <!-- Fabricante -->
            <div>
                <label for="fabricante" class="block text-sm font-medium text-gray-700 mb-1">Fabricante:</label>
                <input id="fabricante" name="fabricante" formControlName="fabricante"
                    class="border border-gray-300 rounded px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500" />

            </div>

            <!-- Quantidade -->
            <div>
                <label for="quantidade" class="block text-sm font-medium text-gray-700 mb-1">Quantidade:</label>
                <input id="quantidade" name="quantidade" formControlName="quantidade" type="number"
                    class="border border-gray-300 rounded px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500" />
                @if(isCampoInvalidoItemForm('quantidade')){
                <span class="text-red-500 text-sm">Campo obrigat√≥rio</span>
                }
            </div>
        </div>

        <!-- Linha de campos agrupados -->
        <div class="grid grid-cols-2 gap-4">

            <!-- Tipo de medida -->
            <div>
                <label for="tipo" class="block text-sm font-medium text-gray-700 mb-1">Tipo de medida:</label>
                <select id="tipo" name="tipo" formControlName="tipo"
                    class="border border-gray-300 rounded px-3 py-2 w-full bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="PC">PC</option>
                    <option value="M">M</option>
                </select>
                @if(isCampoInvalidoItemForm('tipo')){
                <span class="text-red-500 text-sm">Campo obrigat√≥rio</span>
                }
            </div>

            <!-- Custo unit√°rio -->
            <div>
                <label for="custo" class="block text-sm font-medium text-gray-700 mb-1">Custo unit√°rio:</label>
                <input id="custo" name="custo" formControlName="custo" type="number"
                    class="border border-gray-300 rounded px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500" />

                @if(isCampoInvalidoItemForm('custo')){
                <span class="text-red-500 text-sm">Campo obrigat√≥rio</span>
                }
            </div>
        </div>

        <!-- Observa√ß√µes -->
        <div>
            <label for="obs" class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes:</label>
            <textarea id="obs" name="obs" formControlName="obs"
                class="border border-gray-300 rounded px-3 py-2 w-full resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
        </div>

        <!-- Bot√£o -->
        <div class="text-end">
            <button type="submit"
                class="w-60 bg-blue-600 text-white text-lg py-2 rounded hover:bg-blue-700 transition-colors mr-2">Adicionar
                Item</button>
        </div>
        <div class="pt-4 text-end">
            <button (click)="limparFormulario()"
                class="w-60 bg-yellow-400 text-white text-lg py-2 rounded hover:bg-yellow-700 transition-colors mr-2">Limpar
                Formul√°rio</button>

            <button (click)="finalizarPedido()"
                class="w-60 bg-green-600 text-white text-lg py-2 rounded hover:bg-green-700 transition-colors ml-2">Finalizar
                Pedido
            </button>
        </div>

    </form>
</div>
}